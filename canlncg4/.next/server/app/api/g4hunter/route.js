"use strict";(()=>{var e={};e.id=110,e.ids=[110],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},12781:e=>{e.exports=require("stream")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},99574:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>_,requestAsyncStorage:()=>h,routeModule:()=>p,serverHooks:()=>c,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>d});var s={};r.r(s),r.d(s,{POST:()=>i}),r(95655);var a=r(83323),l=r(54647),n=r(41779);let o=class{constructor(){}async get_data(e,t,r,s){let a;if("NCBI_ID"===s){let{seq:s,url:l}=await this.get_fasta_and_link(e);a=await this.get_g4hunter_data(s,t,r)}else if("seq"===s)a=await this.get_g4hunter_data(e,t,r);else{console.log("Wrong input type");return}let l=a;for(let e of l){let[t,r]=this.numg_calc(e.sequence);e.numg=t}return l}async get_fasta_and_link(e){let t,r;for(let s=0;s<5;s++){let s=`https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=nuccore&id=${e}&rettype=fasta&retmode=text`,a=await n.Z.get(s);if(console.log(a.data),console.log(a.data.substring(a.data.indexOf("\n")+1)),a.data.substring(a.data.indexOf("\n")+1).length>0){t="";for(let e=0;e<a.data.split("\n").slice(1).length;e++)t+=a.data.split("\n").slice(1)[e];r=s;break}}return{seq:t,url:r}}calculate_g4hunter_score(e){let t=e.length,r=0,s=[];for(;r<t;){let a=1;if(e[r].toLowerCase().startsWith("g")){let l=!1;for(let s=r+1;s<t;s++)if(e[s].toLowerCase().startsWith("g"))a+=1;else{r=s-1,l=!0;break}l||(r=t);for(let e=0;e<a;e++)s.push(Math.min(a,4))}else if(e[r].toLowerCase().startsWith("c")){let l=!1;for(let s=r+1;s<t;s++)if(e[s].toLowerCase().startsWith("c"))a+=1;else{r=s-1,l=!0;break}l||(r=t);for(let e=0;e<a;e++)s.push(-1*Math.min(a,4))}else s.push(0);r+=1}return s}async get_g4hunter_data(e,t,r){let s={},a=this.calculate_g4hunter_score(e);for(let l=0;l<e.length-t+1;l++){let e=a.slice(l,l+t),n=0;for(let t=0;t<e.length;t++)n+=e[t];let o=n/t;Math.abs(o)>=r&&(s[l]=o)}s[e.length+1]=null;let l=null,n=null,o=[];for(let r of Object.keys(s))if(null===l)n=l=parseInt(r);else if(parseInt(r)-1===n)n=parseInt(r);else{let a=[];for(let e=l;e<n+1;e++)a.push(s[e]);let i=Math.max(...a),u=l+a.indexOf(i),p=e.slice(u,u+t);o.push({sequence:p,start:u,score:i,len:p.length}),l=parseInt(r),n=parseInt(r)}return o}numg_calc(e){let t=null,r=[],s=0;for(;s<e.length;)if("G"===e[s]){let t=0;for(;"G"===e[t+s]&&!((t+=1)+s>=e.length););r.push(t),s+=t}else r.push(0),s+=1;let a=[...r];for(let e=4;e>0;e--){let s=0;for(let t of r)t===e&&(s+=1);if(s>=4){t=e;break}{let t=[];for(let r=0;r<a.length;r++)a[r]>=e&&e>1?t.push(...Array(Math.floor(a[r]/(e-1))).fill(e-1)):t.push(a[r]);r=t}}return null===t?[0,[-1]]:[t,[0,0,0,0]]}},i=async e=>{let t;let r=await e.json(),{inputString:s,windowSize:a,threshold:l}=r;try{if(s.startsWith(">")){let e=s.split("\n"),r="";for(let t=0;t<e.length;t++)r+=e[t];let n=new o;t=await n.get_data(r,a,l,"seq")}else if(s.startsWith("NR")){let e=new o;t=await e.get_data(s,a,l,"NCBI_ID")}else{let e=new o;t=await e.get_data(s,a,l,"seq")}let e=t.filter(e=>e.score>0&&e.numg>=2&&e.numg<=4);return console.log(e),Response.json({result:e},{status:200})}catch(e){return console.log(e),Response.json({message:"An error occurred"},{status:500})}},u=a.AppRouteRouteModule,p=new u({definition:{kind:l.x.APP_ROUTE,page:"/api/g4hunter/route",pathname:"/api/g4hunter",filename:"route",bundlePath:"app/api/g4hunter/route"},resolvedPagePath:"C:\\DATA\\Code\\IITGN\\CanlncG4\\canlncg4\\app\\api\\g4hunter\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:c,headerHooks:f,staticGenerationBailout:d}=p,_="/api/g4hunter/route"}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[405,779],()=>r(99574));module.exports=s})();